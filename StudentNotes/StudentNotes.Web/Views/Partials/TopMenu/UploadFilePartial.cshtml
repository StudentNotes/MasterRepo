@using StudentNotes.Web.Models.ResourcesFinderLogic

<div class="modal fade" id="uploadFileModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h2 class="modal-title" id="myModalLabel">@ResourceKeyResolver.ConstAddNote</h2>
            </div>
            @using (Html.BeginForm("SendFile", "File", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    <p>
                        <span class="label col-xs-12">Wybierz plik z dysku:</span><br />
                        <span id="filePath" class="col-xs-7 label file-path">Nazwa pliku</span>
                        <span class="btn btn-default btn-file col-xs-offset-1 col-xs-4">
                            Przeglądaj...
                            <input id="fileInput" type="file" multiple name="files" onchange="fileSelected()">
                        </span>
                    </p>
                    <br /><br />
                    <p>
                        <span class="label col-xs-12">Zdefiniuj typ pliku:</span><br />
                        @Html.RadioButton("fileType", "Private", true, new {@id="privateFileUploadCheckBox", @class = "file-radio-button" }) prywatny<br />
                        @Html.RadioButton("fileType", "University", new { @id = "universityFileUploadCheckBox", @class = "file-radio-button" }) uczelniany/szkolny
                    </p>

                    <div id="showUploadFileForm" class="form-horizontal hidden">
                        <span class="label col-xs-12">Gdzie chcesz, by plik został zapisany:</span><br />
                        <div class="form-group">
                            <label class="control-label col-sm-4 col-sm-12">Uczelnia:</label>
                            <div class="col-sm-8 col-xs-112">
                                <select id="universitiesSelect" class="form-control"></select>
                            </div>

                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-4 col-sm-12">Kierunek:</label>
                            <div class="col-sm-8 col-xs-112">
                                <select id="studySubjectsSelect" class="form-control"></select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-4 col-sm-12">Semestr:</label>
                            <div class="col-sm-8 col-xs-112">
                                <select id="semestersSelect" class="form-control"></select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-4 col-sm-12">Przedmiot:</label>
                            <div class="col-sm-8 col-xs-112">
                                <select id="semesterSubjectsSelect" class="form-control"></select>
                            </div>
                        </div>
                        <input id="inputPath" type="text" name="uploadPath" value="" hidden/>
                        <input id="inputStudySubjectId" type="text" name="semesterSubjectId" value="" hidden />
                    </div>

                    <br /><br />
                    <p>
                        <span class="label col-xs-12">Dodaj tagi do pliku</span><br />
                        <div class="col-xs-12">
                            <div class="label col-xs-6">
                                Tag1, Tag2, Tag3
                            </div>
                            <div class="label col-xs-6">
                                <div class="label">Dodaj tag</div>
                            </div>
                        </div>
                    </p>
                    <br /><br />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input id="sendButton" type="submit" name="Wyślij!" class="btn btn-primary" />
                </div>
            }
        </div>
    </div>
</div>

<script>
    document.getElementById('privateFileUploadCheckBox').addEventListener('change', HideUploadForm);
    document.getElementById('universityFileUploadCheckBox').addEventListener('change', ShowUploadForm);

    document.getElementById('universitiesSelect').addEventListener('change', UniversityChosen);
    document.getElementById('studySubjectsSelect').addEventListener('change', StudySubjectChosen);
    document.getElementById('semestersSelect').addEventListener('change', SemesterChosen);
    document.getElementById('semesterSubjectsSelect').addEventListener('change', SemesterSubjectChosen);
    

    function HideUploadForm() {
        var uploadForm = document.getElementById('showUploadFileForm');
        uploadForm.setAttribute("class", "form-horizontal hidden");
        $('#sendButton').removeAttr("disabled");
    }

    function ShowUploadForm() {
        var uploadForm = document.getElementById('showUploadFileForm');
        uploadForm.setAttribute("class", "form-horizontal");

        ClearSelect(document.getElementById('universitiesSelect'));
        ClearSelect(document.getElementById('studySubjectsSelect'));
        ClearSelect(document.getElementById('semestersSelect'));
        ClearSelect(document.getElementById('semesterSubjectsSelect'));

        DisableSelect(document.getElementById('studySubjectsSelect'));
        DisableSelect(document.getElementById('semestersSelect'));
        DisableSelect(document.getElementById('semesterSubjectsSelect'));

        ClearPath();
        $('#inputStudySubjectId').val("");
        $('#sendButton').attr("disabled", "true");
        $.getJSON("/LoggedIn/GetSchoolsJson", null, handleJsonSchools);
    }

    function ClearSelect(select) {
        while (select.firstChild) {
            select.removeChild(select.firstChild);
        }
        var option = document.createElement("option");
        option.setAttribute("value", 0);
        var text = document.createTextNode("-");

        option.appendChild(text);
        select.appendChild(option);
    }

    function DisableSelect(select) {
        select.setAttribute("disabled", "true");
    }
    function EnableSelect(select) {
        select.removeAttribute("disabled");
    }

    function UniversityChosen() {
        var universityValue = $('#universitiesSelect').val();
        if (universityValue != 0) {
            console.log("Wybrałeś uczelnię. " + universityValue);
            $.getJSON("/LoggedIn/GetStudySubjectsJson", { universityId: universityValue }, handleJsonStudySubjects);
        } else {
            $('#sendButton').attr("disabled", "true");
        }
        DisableSelect(document.getElementById('studySubjectsSelect'));
        DisableSelect(document.getElementById('semestersSelect'));
        DisableSelect(document.getElementById('semesterSubjectsSelect'));
        ClearSelect(document.getElementById('studySubjectsSelect'));
        ClearSelect(document.getElementById('semestersSelect'));
        ClearSelect(document.getElementById('semesterSubjectsSelect'));
        ClearPath();
    }

    function StudySubjectChosen() {
        var studySubjectValue = $('#studySubjectsSelect').val();
        if (studySubjectValue != 0) {
            console.log("Wybrałeś uczelnię.");
            $.getJSON("/LoggedIn/GetSemestersJson", { studySubjectId: studySubjectValue }, handleJsonSemesters);
        } else {
            $('#sendButton').attr("disabled", "true");
        }
        DisableSelect(document.getElementById('semestersSelect'));
        DisableSelect(document.getElementById('semesterSubjectsSelect'));
        ClearSelect(document.getElementById('semestersSelect'));
        ClearSelect(document.getElementById('semesterSubjectsSelect'));
        ClearPath();      
    }

    function SemesterChosen() {
        var semesterValue = $('#semestersSelect').val();
        if (semesterValue != 0) {
            console.log("Wybrałeś uczelnię.");
            $.getJSON("/LoggedIn/GetSemesterSubjectsJson", { semesterId: semesterValue }, handleJsonSemesterSubjects);
        } else {
            $('#sendButton').attr("disabled", "true");
        }
        DisableSelect(document.getElementById('semesterSubjectsSelect'));
        ClearSelect(document.getElementById('semesterSubjectsSelect'));
        ClearPath();
    }

    function SemesterSubjectChosen() {
        var semesterSubjectSelect = $('#semesterSubjectsSelect');
        console.log("SemesterSubjectValue = " + semesterSubjectSelect.val());
        if (semesterSubjectSelect.val() != 0) {
            console.log("Wybrałeś przedmiot.");
            CreatePath();
            $('#inputStudySubjectId').val(semesterSubjectSelect.val());
        } else {
            console.log("Clearing path!");
            $('#sendButton').attr("disabled", "true");
            ClearPath();
        }
    }

    function handleJsonSchools(data) {
        var select = document.getElementById('universitiesSelect');
        for (var i = 0; i < data.length; i++) {
            var option = document.createElement("option");
            option.setAttribute("value", data[i].UniversityId);
            var text = document.createTextNode(data[i].UniversityName);

            option.appendChild(text);
            select.appendChild(option);
        }
    }

    function handleJsonStudySubjects(data) {
        var select = document.getElementById('studySubjectsSelect');
        EnableSelect(select);
        ClearSelect(select);
        for (var i = 0; i < data.length; i++) {
            var option = document.createElement("option");
            option.setAttribute("value", data[i].StudySubjectId);
            var text = document.createTextNode(data[i].Grade + " - " + data[i].StudySubjectName);

            option.appendChild(text);
            select.appendChild(option);
        }
    }

    function handleJsonSemesters(data) {
        var select = document.getElementById('semestersSelect');
        EnableSelect(select);
        ClearSelect(select);
        for (var i = 0; i < data.length; i++) {
            var option = document.createElement("option");
            option.setAttribute("value", data[i].SemesterId);
            var text = document.createTextNode("Semestr " + data[i].SemesterNumber);

            option.appendChild(text);
            select.appendChild(option);
        }
    }

    function handleJsonSemesterSubjects(data) {
        
        var select = document.getElementById('semesterSubjectsSelect');
        EnableSelect(select);
        ClearSelect(select);
        for (var i = 0; i < data.length; i++) {
            var option = document.createElement("option");
            option.setAttribute("value", data[i].SemesterSubjectId);
            var text = document.createTextNode(data[i].SemesterSubjectName);

            option.appendChild(text);
            select.appendChild(option);
        }
    }

    function CreatePath() {
        var fullPath = "";
        var part1 = $('#universitiesSelect option:selected').text();
        var part2_3 = $('#studySubjectsSelect option:selected').text().split(" - ");
        var part2 = part2_3[0];
        var part3 = part2_3[1];
        var part4 = $('#semestersSelect option:selected').text();
        var part5 = $('#semesterSubjectsSelect option:selected').text();

        fullPath += part1 + "/" + part2 + "/" + part3 + "/" + part4 + "/" + part5;
        console.log(fullPath);

        $('#inputPath').val(fullPath);
        $('#sendButton').removeAttr("disabled");
    }
    function ClearPath() {
        $('#inputPath').val("");
    }
</script>